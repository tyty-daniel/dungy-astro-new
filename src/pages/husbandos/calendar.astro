---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import HusbandoCalendar from '../../components/HusbandoCalendar.jsx';

const husbandos = await getCollection('husbandos');

// Filter out husbandos with unknown birthdays and parse the birthday data
const husbandosWithBirthdays = husbandos
  .filter(h => h.data.birthday && h.data.birthday !== 'Unknown')
  .map(h => {
    const birthday = h.data.birthday;
    // Parse "DD Month" format
    const [day, month] = birthday.split(' ');
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                       'July', 'August', 'September', 'October', 'November', 'December'];
    const monthIndex = monthNames.indexOf(month);
    
    return {
      id: h.id,
      name: h.data.name,
      series: h.data.series,
      birthday: birthday,
      day: parseInt(day),
      month: monthIndex,
      heroImage: h.data.heroImage
    };
  })
  .filter(h => h.month !== -1); // Remove any with invalid month names
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title="Husbandos Birthday Calendar" description="Calendar view of all husbando birthdays" />
        <style>
            main {
                width: 960px;
                max-width: 100vw;
                margin: 0 auto;
                padding: 2rem 1rem;
            }
        </style>
    </head>
    <body>
        <Header />
        <main>
            <h1 class="font-sans text-blue-900 text-4xl m-0 mb-4">Husbandos Birthday Calendar</h1>
            <p class="mb-6">Navigate through the months to see when your favorite husbandos celebrate their birthdays!</p>
            
            <HusbandoCalendar husbandos={husbandosWithBirthdays} client:load />
        </main>
        <Footer />
    </body>
</html>